<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>How to Build Your Own Custom C2 Framework</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">How to Build Your Own Custom C2 Framework</h1>
</header>
<section data-field="subtitle" class="p-summary">
TL;DR: A C2 framework can be as simple as you’d like it, in this case, it just 3 components: a fancy while loop to execute commands on the…
</section>
<section data-field="body" class="e-content">
<section name="2ac1" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7c1e" id="7c1e" class="graf graf--h3 graf--leading graf--title">How to Build Your Own Custom C2 Framework</h3><p name="de59" id="de59" class="graf graf--p graf-after--h3"><em class="markup--em markup--p-em">TL;DR: A C2 framework can be as simple as you’d like it, in this case, it just 3 components: a fancy while loop to execute commands on the host, a fancy web interface to send basic commands to a flask script, the flask script to deal with commands and results from/to agents and interfaces</em></p><h3 name="8ff4" id="8ff4" class="graf graf--h3 graf-after--p">Introduction</h3><p name="2681" id="2681" class="graf graf--p graf-after--h3">In this post, we are going to be talking through the process of creating a command and control (C2) framework. The approach we are going to be taking here will revolve around setting a lightweight agent on an endpoint and having it call back to a server to receive and send commands.</p><p name="727e" id="727e" class="graf graf--p graf-after--p">There are a million different ways of doing this but the above is how I have chosen to approach this. The main idea and approach for this project started with my need for a custom version of <a href="https://github.com/t3l3machus/hoaxshell" data-href="https://github.com/t3l3machus/hoaxshell" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">hoaxshell by t3l3machus [001]</a>.</p><p name="fa72" id="fa72" class="graf graf--p graf-after--p">So what is the need we are fulfilling with this project: I needed a small lightweight reverse shell setup that could bypass EDR and get me code execution on a remote system. For this, a simple PowerShell agent is enough. I also needed some infrastructure to control this agent. Initially, this was done via the terminal, but for this next phase of the project, we will set up a web app to handle user interaction. The agent and infrastructure are primarily meant for internal penetration tests to get code execution on servers, but can also be used for lightweight initial access. In addition to this, I also wanted the server to support file hosting of engagement tools, without having to run two different servers on different ports.</p><h4 name="4f48" id="4f48" class="graf graf--h4 graf-after--p">Other inspiration</h4><p name="ce28" id="ce28" class="graf graf--p graf-after--h4">Below is a list of other sources of inspiration that went into this project</p><ul class="postList"><li name="1d21" id="1d21" class="graf graf--li graf-after--p">Havoc C2 framework- <a href="https://github.com/HavocFramework/Havoc" data-href="https://github.com/HavocFramework/Havoc" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://github.com/HavocFramework/Havoc</a></li><li name="2ef3" id="2ef3" class="graf graf--li graf-after--li">Building a C2 implant with Nim — <a href="https://casvancooten.com/posts/2021/08/building-a-c2-implant-in-nim-considerations-and-lessons-learned/" data-href="https://casvancooten.com/posts/2021/08/building-a-c2-implant-in-nim-considerations-and-lessons-learned/" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://casvancooten.com/posts/2021/08/building-a-c2-implant-in-nim-considerations-and-lessons-learned/</a></li><li name="1a0f" id="1a0f" class="graf graf--li graf-after--li">Building a c2 framework in c++ — <a href="https://shogunlab.gitbook.io/building-c2-implants-in-cpp-a-primer" data-href="https://shogunlab.gitbook.io/building-c2-implants-in-cpp-a-primer" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://shogunlab.gitbook.io/building-c2-implants-in-cpp-a-primer</a></li></ul><h3 name="e9a9" id="e9a9" class="graf graf--h3 graf-after--li">Prerequisites</h3><p name="551c" id="551c" class="graf graf--p graf-after--h3">To get the most out of this post the following skills would form a good base:</p><ul class="postList"><li name="f3f4" id="f3f4" class="graf graf--li graf-after--p">Basic experience with full-stack development</li><li name="5525" id="5525" class="graf graf--li graf-after--li">Basic penetration testing experience — i.e. having tried Metasploit before</li><li name="fdb1" id="fdb1" class="graf graf--li graf-after--li">Programming know-how</li></ul><p name="8586" id="8586" class="graf graf--p graf-after--li">But since this topic is not the most advanced, you should be able to read and understand what we are going for here without too much trouble.</p><h4 name="c69f" id="c69f" class="graf graf--h4 graf-after--p">Basic Concepts</h4><p name="659f" id="659f" class="graf graf--p graf-after--h4">To ensure that we are all on the same page, here is a brief overview of the terminology used in this post and how the different terms are used, as many of these are often used interchangeably it will be a lot easier for all of us if some standard definitions are set out:</p><ul class="postList"><li name="f282" id="f282" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Agent </strong>— this is the code running on a victim, often times the term implant is also used, these are your: meterpreter shells, covenant beacons, covenant grunts etc. so what will be running our commands.</li><li name="8adf" id="8adf" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Server/backend/API </strong>— some piece of code/infrastructure listening for incoming requests, in this case, this will be referring to the backend handling both incoming requests from agents and user interactions via the frontend.</li><li name="7342" id="7342" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Frontend </strong>— this is the web component that users/operators will be using to interact with agents and the underlying infrastructure.</li></ul><h3 name="a2d5" id="a2d5" class="graf graf--h3 graf-after--li">Requirements</h3><p name="1ff3" id="1ff3" class="graf graf--p graf-after--h3">So now that that is over with let&#39;s get to setting our requirements:</p><ul class="postList"><li name="89eb" id="89eb" class="graf graf--li graf-after--p">We need a simple agent running on a Windows host and a way to generate it without EDR catching it.</li><li name="d258" id="d258" class="graf graf--li graf-after--li">We need a robust backend for handling agents — this needs to be able to handle multiple sessions/agents.</li><li name="7b3b" id="7b3b" class="graf graf--li graf-after--li">We need a nice frontend to do our work i.e. it needs to look cool for screenshots.</li><li name="30d7" id="30d7" class="graf graf--li graf-after--li">We need a way to host and access files to be used during the engagement.</li></ul><p name="a0b5" id="a0b5" class="graf graf--p graf-after--li">In addition to these functional requirements, the following is also required for production software</p><ul class="postList"><li name="b01d" id="b01d" class="graf graf--li graf-after--p">Robust error handling</li><li name="b36d" id="b36d" class="graf graf--li graf-after--li">Logging of access attempts</li><li name="850b" id="850b" class="graf graf--li graf-after--li">Logging of commands and outputs, with timestamps</li><li name="2ccb" id="2ccb" class="graf graf--li graf-after--li">Authentication for sensitive endpoints and data</li></ul><p name="8a28" id="8a28" class="graf graf--p graf-after--li">So now that we have our general requirements we can move on to design and the last pieces of information before getting started on the development of the project.</p><h3 name="7b9b" id="7b9b" class="graf graf--h3 graf-after--p">Architecture</h3><p name="6c43" id="6c43" class="graf graf--p graf-after--h3">So now we have a general idea of what we are trying to do and the tools we will be using to achieve the goal of executing commands on a remote host without the urge to jump off a bridge… for this I came up with the following solution, heavily inspired by the great work of others. None of these frameworks or languages is especially important, more or less every language can be used if you want to create everything in plain PHP that is just as viable.</p><p name="f8a0" id="f8a0" class="graf graf--p graf-after--p">When you have selected your weapon of choice, it is now time to do some thinking about how everything will come together.</p><h4 name="925f" id="925f" class="graf graf--h4 graf-after--p">Agents</h4><p name="2bf7" id="2bf7" class="graf graf--p graf-after--h4">Starting with the easiest part, the agent. This is just a glorified while loop that does GET and POST requests. GET to retrieve the command to execute, POST to send the results. State management is done via headers. Two headers to be specific, the first has the “ID” of the command this helps to manage which command was executed and ensure that the result is stored in the correct place. and a second which is the ID of the agent, the last one acts as the authentication token, if that is not there the API will not respond. And that is it, this can be made as complicated or as simple as you&#39;d like, you could create everything from scratch in C or as I did just have a PowerShell script. I chose PowerShell as it was easy and since I needed the agent to be in something that I could just copy and paste where I needed it.</p><h4 name="4ec8" id="4ec8" class="graf graf--h4 graf-after--p">Frontend</h4><p name="a187" id="a187" class="graf graf--p graf-after--h4">Next up is the part you will be staring at for the most time… both for development and for general use… the frontend! The functionality here is by far the simplest, we just want somewhere we can get an overview of the agents we have deployed, send them commands and see the results. Sounds simple! … and it is, there is nothing fancy here you can make everything as simple or complex as you&#39;d like. I ended up spending a bunch of time here getting comfort features implemented such as nice self-updating overviews, a display for events and alerts on the backend, and a nice interface for generating agents allowing for the selection of different features and requirements. Even more, than the agents, this is where you can get creative and more or less spend all the time in the world adding features and tweaking everything to your liking. Again the framework does not matter in the slightest as long as you are comfortable with it and know how to make it work for you.</p><p name="b938" id="b938" class="graf graf--p graf-after--p">Another thing to keep in mind is that this is where the screenshots will be coming from so make sure it looks sufficiently cool ;)</p><h4 name="62c4" id="62c4" class="graf graf--h4 graf-after--p">API / Backend</h4><p name="be8a" id="be8a" class="graf graf--p graf-after--h4">This is what will make sure that everything is synced and will be responsible for everything from the generation of agents to authentication both for agents and the front end, it will generate event logs and keep track of commands sent received and executed, it will handle sessions for agents etc.</p><p name="ae47" id="ae47" class="graf graf--p graf-after--p">Sounds like a big mouthful… and it is, but breaking it down into its separate components actually shows that though it sounds complicated the implementation is rather simple. So what are these components you might ask, well let me show you:</p><ul class="postList"><li name="0137" id="0137" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Sending data to the front end</strong> - this can be everything from the agent sessions to new shells. here the different requirements for information are split into different endpoints</li><li name="7076" id="7076" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Authentication </strong>— this is done for both agents and the front end, the frontend authentication is done via react routes, that check the session against flask sessions on the backend. Authentication is also done for agents, here however the authentication is based on a header set at the creation of the agent. Whenever an agent is generated this session identifier is stored for later reference</li><li name="02d0" id="02d0" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Logging of events</strong> — whenever an event or alert happens it is both printed in the terminal, added to a dictionary to be displayed in the frontend and also logged to a local file for audit purposes</li><li name="caf8" id="caf8" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Serving of commands to agents </strong>— here the backend just has some endpoints to receive results and send commands, also here there is some logic to register if an agent has been seen before (will also verify session header to check for auth), if not then the session is added to the list of active sessions. Also, data structures are updated to keep track of commands with all the info that goes along here.</li></ul><p name="e553" id="e553" class="graf graf--p graf-after--li">And that covers the functionality of the API.</p><h4 name="8bd2" id="8bd2" class="graf graf--h4 graf-after--p">How will it all work together?</h4><p name="ea36" id="ea36" class="graf graf--p graf-after--h4">So now that we have a better idea of the components that will go together. How will they interact? Well, this part ended up being the most simple of the whole project. The frontend will only be dealing with the flask API and send requests for information, commands to be sent for agents, and requests for the generation of shells. The agent will be doing all GET and POST requests to the flask API as well. And then the Flask API will be responsible for coordinating everything from logins to the frontend to the generation of agents, and serving of files, it is this that will need to be exposed to the network where the agent will be calling from.</p><p name="304e" id="304e" class="graf graf--p graf-after--p">Did that clarify it? No… ok then let&#39;s make some diagrams for a typical workflow for the agent and backend API, I won&#39;t deal with the frontend as that is just a regular website fetching and putting some data from an API (for that I found the blog post <a href="https://blog.miguelgrinberg.com/post/how-to-create-a-react--flask-project" data-href="https://blog.miguelgrinberg.com/post/how-to-create-a-react--flask-project" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">“How To Create a React + Flask Project” [005]</a> very useful for getting an initial understanding of the setup):</p><figure name="e4a3" id="e4a3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*I_UrmtiMC3Vp0H0Ht2w_Lg.png" data-width="682" data-height="1031" src="https://cdn-images-1.medium.com/max/800/1*I_UrmtiMC3Vp0H0Ht2w_Lg.png"><figcaption class="imageCaption">Workflow of agent server communication</figcaption></figure><p name="06c6" id="06c6" class="graf graf--p graf-after--figure">Now with that out of the way, let&#39;s look at the last details before seeing the result of all these considerations.</p><h4 name="0722" id="0722" class="graf graf--h4 graf-after--p">Programming language(s) of choice</h4><p name="8f2b" id="8f2b" class="graf graf--p graf-after--h4">The programming languages I chose for this project, these were languages which I was comfortable and in general followed the mantra of not creating something new with a new language. Therefore I choose ReactJs as the front end and Python flask for the backend.</p><p name="3197" id="3197" class="graf graf--p graf-after--p">The reason for choosing ReactJs for the front end as opposed to HTMX or Laravel or similar was that I wanted something well documented that I could iterate quickly in and performance and maintainability are not a huge concern as future updates would likely start with major reworks and refinements anyway.</p><p name="a2a5" id="a2a5" class="graf graf--p graf-after--p">As for Python flask, it&#39;s simple I knew it, I knew it well and could whip up an application in a short amount of time. It is easy to understand, implement, and read. And since all logic is done in the backend via the API it meant that the “difficult” parts could be done rather smoothly.</p><h3 name="f916" id="f916" class="graf graf--h3 graf-after--p">Why no Code snippets?!</h3><p name="e65d" id="e65d" class="graf graf--p graf-after--h3">by now you have probably already scrolled down through the post and wondered why there is no code for you to copy and paste. The answer is simple: because it is not that difficult. Nothing about this project is especially difficult if you know how to program. We are more or less just setting up a web server with a backend API. Most of this stuff can either be “borrowed” from stack overflow or you can get ChatGPT to do it for you… so stop being lazy.</p><h3 name="b561" id="b561" class="graf graf--h3 graf-after--p">Defense Evasion</h3><p name="a8e1" id="a8e1" class="graf graf--p graf-after--h3">For defense evasion, we are not doing anything too interesting or complicated. As stated previously we are basing the general approach off hoaxshell [001], additionally, we are adding some obfuscation to our script based on <a href="https://github.com/t3l3machus/PowerShell-Obfuscation-Bible" data-href="https://github.com/t3l3machus/PowerShell-Obfuscation-Bible" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">“the PowerShell obfuscation bible” [006]</a> also by t3l3machus.</p><p name="dbfe" id="dbfe" class="graf graf--p graf-after--p">Additional techniques like AMSI bypasses etc. can also be added based on need. However, this will not be covered <a href="https://github.com/Sh3lldon/FullBypass?tab=readme-ov-file" data-href="https://github.com/Sh3lldon/FullBypass?tab=readme-ov-file" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here [007].</a></p><p name="58e7" id="58e7" class="graf graf--p graf-after--p">So, to sum up, the evasion part, what we are going for here is not any fancy unhooking or “active” evasion rather we are just making it so that the reverse shell will always be different and therefore immune to string matching defense mechanisms.</p><h3 name="ab4e" id="ab4e" class="graf graf--h3 graf-after--p">Proof of concept</h3><h4 name="e483" id="e483" class="graf graf--h4 graf-after--h3">Basic Implementation</h4><p name="da5c" id="da5c" class="graf graf--p graf-after--h4">After we have the details planned and have an overall idea of what we are aiming for, what is left is “just” to implement it. This takes a while, no way around it. I was at this point essentially learning frontend and API development when implementing this. Luckily these two facets are way easier and way more well-documented than some of my other projects like rootkit development…. so it did not take that long. Below are some screenshots of the first version of the web frontend before making everything look all fancy with CSS.</p><p name="1df7" id="1df7" class="graf graf--p graf-after--p">And before you ask, the “nice” colours is just to make it easier to figure out the layout of the different elements on the pages.</p><figure name="b794" id="b794" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*-JiCCS-c8wVcScqE17OemQ.png" data-width="1329" data-height="902" src="https://cdn-images-1.medium.com/max/800/1*-JiCCS-c8wVcScqE17OemQ.png"><figcaption class="imageCaption">Main window for communicating and seeing results from agents</figcaption></figure><figure name="4ff7" id="4ff7" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*OSNa1B69hB14FuZtje9pzg.png" data-width="1324" data-height="896" src="https://cdn-images-1.medium.com/max/800/1*OSNa1B69hB14FuZtje9pzg.png"><figcaption class="imageCaption">Interface for generating reverse shells with options for obfuscation</figcaption></figure><figure name="2b22" id="2b22" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*4F3ZFR-tjQ-7YfJY7XADIg.png" data-width="1325" data-height="895" src="https://cdn-images-1.medium.com/max/800/1*4F3ZFR-tjQ-7YfJY7XADIg.png"><figcaption class="imageCaption">Prototype interface for having multiple ports for reverse shells to communicate on — Later scrapped</figcaption></figure><figure name="d7bf" id="d7bf" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*8F-P3NH2sh5xkTYqBO85cw.png" data-width="825" data-height="895" src="https://cdn-images-1.medium.com/max/800/1*8F-P3NH2sh5xkTYqBO85cw.png"><figcaption class="imageCaption">A page for hosting files to be downloaded during the engagement</figcaption></figure><p name="fed8" id="fed8" class="graf graf--p graf-after--figure">The above assets are what is going to be the core of the application, and were used to get everything set up correctly and get basic functionality implemented.</p><h4 name="a01a" id="a01a" class="graf graf--h4 graf-after--p">The Magic of CSS</h4><p name="0d82" id="0d82" class="graf graf--p graf-after--h4">Now you are probably left sitting there thinking WOW! … that looks a bit shit!.. and you are correct. Luckily this can all be fixed with the magic of CSS. CSS is dangerous as the time spent finetuning this part of the application can be more or less infinite if not kept in check. However, I still think it is still a good idea to spend some time here as this is what takes your frontend from looking like something from the 90 to something looking half decent and usable. Plus this is probably the only part of the application that most of the people you will show it to will see.</p><p name="6516" id="6516" class="graf graf--p graf-after--p">So, spending some time getting everything looking nice I ended up with the frontend looking like this (Note that “SIDEWINDER” is what I choose to call the whole project):</p><figure name="432f" id="432f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3cnyG9lt0u8K8rhaIWF21w.png" data-width="1919" data-height="955" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*3cnyG9lt0u8K8rhaIWF21w.png"><figcaption class="imageCaption">Main page post-CSS updates</figcaption></figure><figure name="b3c9" id="b3c9" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*zmsOxASbNHbAGOt3VaHL_g.png" data-width="1916" data-height="955" src="https://cdn-images-1.medium.com/max/800/1*zmsOxASbNHbAGOt3VaHL_g.png"><figcaption class="imageCaption">Reverse shell generation page post-CSS updates</figcaption></figure><figure name="e55f" id="e55f" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*SZjKPNNLIt3FCyr25Itt7A.png" data-width="1856" data-height="792" src="https://cdn-images-1.medium.com/max/800/1*SZjKPNNLIt3FCyr25Itt7A.png"><figcaption class="imageCaption">Web file sharing post-CSS updates</figcaption></figure><h3 name="e233" id="e233" class="graf graf--h3 graf-after--figure">Deployment</h3><p name="2f8b" id="2f8b" class="graf graf--p graf-after--h3">So now we have something nice up and running, but how do we use it in engagements? If you are like the rest of us then you will be using a new virtual machine per engagement. To do this I just created a basic bash script to sort everything for me, the contents of which ended up looking a bit like this:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="768d" id="768d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># general system update</span><br />sudo apt-get update<br /><span class="hljs-comment"># download</span><br />git <span class="hljs-built_in">clone</span> https://&lt;PAT&gt;@github.com/&lt;GithubUsername&gt;/SIDEWINDER<br /><span class="hljs-comment"># Move to dir</span><br /><span class="hljs-built_in">cd</span> SIDEWINDER<br /><span class="hljs-comment"># flask setup</span><br />pip install flask_session<br /><span class="hljs-comment"># reactjs setup</span><br /><span class="hljs-built_in">cd</span> src<br />sudo apt install npm<br />npm install<br /><br /><br /><br /></span></pre><p name="fcdb" id="fcdb" class="graf graf--p graf-after--pre">and for starting the servers the following commands are used</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="c386" id="c386" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># start servers</span><br /><span class="hljs-built_in">cd</span> api<br />flask --app api_main run --host=0.0.0.0<br /><span class="hljs-built_in">cd</span> src<br />npm start</span></pre><p name="cf39" id="cf39" class="graf graf--p graf-after--pre">This like everything else here can be done in a million different ways, and I will probably change my approach as well according to changing needs and just experience from using the thing. For setting up Privileged Access Tokens (PAT) on GitHub I followed <a href="https://kettan007.medium.com/how-to-clone-a-git-repository-using-personal-access-token-a-step-by-step-guide-ab7b54d4ef83" data-href="https://kettan007.medium.com/how-to-clone-a-git-repository-using-personal-access-token-a-step-by-step-guide-ab7b54d4ef83" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">this guide [008]</a>.</p><h4 name="d8e5" id="d8e5" class="graf graf--h4 graf-after--p">Penetration testing</h4><p name="800e" id="800e" class="graf graf--p graf-after--h4">Since we are creating an application that will hold potentially sensitive information and access to systems. It&#39;s probably a good idea to check that the thing is set up and created securely. Therefore it would probably be a good idea to test for the most common issues and pain points. For an application like this, the major pain points would probably be:</p><ul class="postList"><li name="858b" id="858b" class="graf graf--li graf-after--p">Unauthorized access and IDOR.</li><li name="057e" id="057e" class="graf graf--li graf-after--li">Weak cryptography and credentials.</li><li name="e348" id="e348" class="graf graf--li graf-after--li">Information disclosure.</li><li name="c57b" id="c57b" class="graf graf--li graf-after--li">Access control for agents and users, both for frontend and backend.</li></ul><p name="c18b" id="c18b" class="graf graf--p graf-after--li">If uncertain just go through the OWASP top 10 and that should cover most issues. In addition, it is also worth considering the deployment of the setup, such as restricting access based on known IP addresses etc. and system hardening.</p><h3 name="a5be" id="a5be" class="graf graf--h3 graf-after--p">Demo</h3><p name="cc0b" id="cc0b" class="graf graf--p graf-after--h3">And now after all that, here is what you have been waiting for, the demo! In the demo below I&#39;m starting two different shells to showcase shell generation and multi-session handling — the app looks a bit different than the screenshots above because… I don&#39;t know but kali messed up some of the fonts … so that&#39;s nice.</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="d891" id="d891" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><img class="graf-image" data-image-id="1*-t7BlX9jwKA3MC4_LqQTbw.gif" data-width="1908" data-height="969" src="https://cdn-images-1.medium.com/max/1200/1*-t7BlX9jwKA3MC4_LqQTbw.gif"><figcaption class="imageCaption">Multi-session demo</figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><h4 name="4d2a" id="4d2a" class="graf graf--h4 graf-after--figure">Points of Improvement</h4><p name="8756" id="8756" class="graf graf--p graf-after--h4">So after all that, what can be improved? This will not be in-depth or aim to cover everything, just big ticket items which could greatly improve the user experience:</p><ul class="postList"><li name="4b3d" id="4b3d" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">CSS and web interface</strong> — this is the infinity improvement project, I think you could probably keep spending time here until the heat death of the universe. But for this project, a couple of key improvements stand out, such as when a new session is selected in the main menu, the console/terminal should update as well. Other areas such as being able to just press up on the keyboard to get the last command executed would also be very nice. The CSS could be nicer and more refined … and the list keeps going.</li><li name="d6b6" id="d6b6" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">ReactJS</strong>— As this was my first time making a proper web interface with a JS framework, some of the code and solutions chosen here could for sure be improved and made more modular and overall better.</li><li name="ed53" id="ed53" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Flask </strong>— Since I&#39;m used to working with Python this part went pretty well but there is still a bunch of duplicate code, lack of logging and missing error handling that would be nice to have overall just a general cleanup would be nice.</li><li name="5b93" id="5b93" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Maintainability </strong>— the project is very much proof of concept and it will need some reworking for it to be maintainable and stable.</li></ul><p name="2831" id="2831" class="graf graf--p graf-after--li">… and there are many more. As I mentioned previously you can more or less always find something to do and something to change. But for now, I have a viable PoC for playing around with, the key here is not to polish it to a point where you are afraid to make major changes. Additionally, another thing I find important is to create a PoC tool and get it to a usable state as fast as possible, so you can get an idea if it is something you actually want to spend more time on, or if the idea was better in your head than in real life.</p><h3 name="81d0" id="81d0" class="graf graf--h3 graf-after--p">Lessons Learned</h3><p name="1824" id="1824" class="graf graf--p graf-after--h3">A lot was learned during this project, again this is a great type of project to learn a bunch of different new skills and technologies since the basic premise is just a server serving commands over HTTP/HTTPS and a while loop getting those commands. I learned a lot throughout this project, before this my main experience with web development was doing a bunch of sites in PHP, so it was cool to give myself a chance to play around with web frameworks and development. Additionally playing around with agent obfuscation and different forms of encoding was also very rewarding. All in all a great project although a bit time-consuming!</p><h3 name="4a5d" id="4a5d" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="caae" id="caae" class="graf graf--p graf-after--h3">Standing at the end of a project like this, a lot of skills were learned and I now have a cool C2 framework. Although the code needs much work and it might be wise to start completely over and do it again, it is very nice to see the evolution of the project, this started as a simple clone of hoaxshell and is now its own thing. the project has also inspired a lot of new ideas and concepts, like the possibility of a “thicker” client like nimplant, where a compiled binary is used and where functions like a directory listing, uploading and downloading of files, and other basic commands are implemented directly in the binary using the Windows API… maybe we will get around to it another time.</p><p name="8e1d" id="8e1d" class="graf graf--p graf-after--p">Thanks for coming along i hope you learned something new or at least enjoyed the reading. Cheers.</p><h3 name="cda1" id="cda1" class="graf graf--h3 graf-after--p">References</h3><ul class="postList"><li name="2e86" id="2e86" class="graf graf--li graf-after--h3">[001] — <a href="https://github.com/t3l3machus/hoaxshell" data-href="https://github.com/t3l3machus/hoaxshell" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://github.com/t3l3machus/hoaxshell</a></li><li name="cbdc" id="cbdc" class="graf graf--li graf-after--li">[002] — Havoc C2 framework- <a href="https://github.com/HavocFramework/Havoc" data-href="https://github.com/HavocFramework/Havoc" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://github.com/HavocFramework/Havoc</a></li><li name="51fa" id="51fa" class="graf graf--li graf-after--li">[003] — Building a C2 implant with Nim — <a href="https://casvancooten.com/posts/2021/08/building-a-c2-implant-in-nim-considerations-and-lessons-learned/" data-href="https://casvancooten.com/posts/2021/08/building-a-c2-implant-in-nim-considerations-and-lessons-learned/" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://casvancooten.com/posts/2021/08/building-a-c2-implant-in-nim-considerations-and-lessons-learned/</a></li><li name="bf15" id="bf15" class="graf graf--li graf-after--li">[004] — Building a c2 framework in c++ — <a href="https://shogunlab.gitbook.io/building-c2-implants-in-cpp-a-primer" data-href="https://shogunlab.gitbook.io/building-c2-implants-in-cpp-a-primer" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://shogunlab.gitbook.io/building-c2-implants-in-cpp-a-primer</a></li><li name="1d1e" id="1d1e" class="graf graf--li graf-after--li">[005] — How To Create a React + Flask Project — <a href="https://blog.miguelgrinberg.com/post/how-to-create-a-react--flask-project" data-href="https://blog.miguelgrinberg.com/post/how-to-create-a-react--flask-project" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://blog.miguelgrinberg.com/post/how-to-create-a-react--flask-project</a></li><li name="360d" id="360d" class="graf graf--li graf-after--li">[006] PowerShell Obfuscation Bible — <a href="https://github.com/t3l3machus/PowerShell-Obfuscation-Bible" data-href="https://github.com/t3l3machus/PowerShell-Obfuscation-Bible" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://github.com/t3l3machus/PowerShell-Obfuscation-Bible</a></li><li name="dcaa" id="dcaa" class="graf graf--li graf-after--li">[007] — <a href="https://github.com/Sh3lldon/FullBypass?tab=readme-ov-file" data-href="https://github.com/Sh3lldon/FullBypass?tab=readme-ov-file" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://github.com/Sh3lldon/FullBypass?tab=readme-ov-file</a></li><li name="ef68" id="ef68" class="graf graf--li graf-after--li graf--trailing">[008] — <a href="https://kettan007.medium.com/how-to-clone-a-git-repository-using-personal-access-token-a-step-by-step-guide-ab7b54d4ef83" data-href="https://kettan007.medium.com/how-to-clone-a-git-repository-using-personal-access-token-a-step-by-step-guide-ab7b54d4ef83" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">https://kettan007.medium.com/how-to-clone-a-git-repository-using-personal-access-token-a-step-by-step-guide-ab7b54d4ef83</a></li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@0x0vid" class="p-author h-card">0x0vid</a> on <a href="https://medium.com/p/b33b569f0987"><time class="dt-published" datetime="2024-03-28T22:51:29.793Z">March 28, 2024</time></a>.</p><p><a href="https://medium.com/@0x0vid/how-to-build-your-own-custom-c2-framework-b33b569f0987" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on March 28, 2024.</p></footer></article></body></html>